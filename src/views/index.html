<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../assets/img/favicon.png">
  <title>
    Administración - Panel de control
  </title>
  <!-- Fonts and icons -->
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:300,400,500,600,700,900" />
  <!-- Nucleo Icons -->
  <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <!-- CSS Files -->
  <link id="pagestyle" href="../assets/css/material-dashboard.css?v=3.2.0" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/custom.css">
  <style>
    /* Asegura que el main-content no se meta debajo del sidebar */
    #main-content {
      margin-left: 235px; /* Ancho del sidebar */
      transition: margin-left 0.3s ease;
    }
    .g-sidenav-hidden #main-content {
      margin-left: 0;
    }
  </style>
</head>

<body class="g-sidenav-show  bg-gray-100">

 <aside class="sidenav navbar navbar-vertical navbar-expand-xs border-radius-lg fixed-start ms-2 bg-white my-2" id="sidenav-main">
  <div class="sidenav-header">
    <i class="fas fa-times p-3 cursor-pointer text-dark opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
    <a class="navbar-brand px-4 py-3 m-0" href="#" data-view="views/dashboard.html">
      <img src="../assets/img/logo-ct-dark.png" class="navbar-brand-img" width="26" height="26" alt="main_logo">
      <span class="ms-1 text-sm text-dark">LABWARE</span>
    </a>
  </div>
  <hr class="horizontal dark mt-0 mb-2">
  <div class="scroll-wrapper">
    <ul class="navbar-nav">

    <!-- Panel -->
<li class="nav-item" id="liDashboard">
  <a class="nav-link active bg-gradient-dark text-white" href="#" data-view="dashboard.html">
    <i class="material-symbols-rounded opacity-5">dashboard</i>
    <span class="nav-link-text ms-1">Panel de control</span>
  </a>
</li>

<!-- Gestión del sistema -->
<li class="nav-item mt-3" id="liTituloSistema">
  <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-5">Gestión del sistema</h6>
</li>

<li class="nav-item" id="liUsuarios">
  <a class="nav-link text-dark" href="#" data-view="user.html">
    <i class="material-symbols-rounded opacity-5">group</i>
    <span class="nav-link-text ms-1">Usuarios</span>
  </a>
</li>

<li class="nav-item" id="liPacientes">
  <a class="nav-link text-dark" href="#" data-view="patient.html">
    <i class="material-symbols-rounded opacity-5">badge</i>
    <span class="nav-link-text ms-1">Pacientes</span>
  </a>
</li>

<li class="nav-item" id="liDoctores">
  <a class="nav-link text-dark" href="#" data-view="doctor.html">
    <i class="material-symbols-rounded opacity-5">medical_information</i>
    <span class="nav-link-text ms-1">Doctores</span>
  </a>
</li>

<li class="nav-item" id="liExamenes">
  <a class="nav-link text-dark" href="#" data-view="exam.html">
    <i class="material-symbols-rounded opacity-5">science</i>
    <span class="nav-link-text ms-1">Exámenes</span>
  </a>
</li>

<li class="nav-item" id="liCotizador">
  <a class="nav-link text-dark" href="#" data-view="quoter.html">
    <i class="material-symbols-rounded opacity-5">receipt_long</i>
    <span class="nav-link-text ms-1">Cotizador</span>
  </a>
</li>

<!-- Gestión de órdenes -->
<li class="nav-item mt-3" id="liTituloOrdenes">
  <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-5">Gestión de órdenes</h6>
</li>

<li class="nav-item" id="liNuevaOrden">
  <a class="nav-link text-dark" href="#" data-view="neworder.html">
    <i class="material-symbols-rounded opacity-5">add_circle</i>
    <span class="nav-link-text ms-1">Nueva</span>
  </a>
</li>

<li class="nav-item" id="liRecepcion">
  <a class="nav-link text-dark" href="#" data-view="order.html">
    <i class="material-symbols-rounded opacity-5">move_to_inbox</i>
    <span class="nav-link-text ms-1">Recepción</span>
  </a>
</li>

<li class="nav-item" id="liProcesamiento">
  <a class="nav-link text-dark" href="#" data-view="report.html">
    <i class="material-symbols-rounded opacity-5">assignment</i>
    <span class="nav-link-text ms-1">Análisis</span>
  </a>
</li>

<li class="nav-item" id="liValidacion">
  <a class="nav-link text-dark" href="#" data-view="validated.html">
    <i class="material-symbols-rounded opacity-5">task_alt</i>
    <span class="nav-link-text ms-1">Validación</span>
  </a>
</li>

<li class="nav-item" id="liRemision">
  <a class="nav-link text-dark" href="#" data-view="remission.html">
    <i class="material-symbols-rounded opacity-5">outbox</i>
    <span class="nav-link-text ms-1">Remisión</span>
  </a>
</li>

<li class="nav-item" id="liArchivo">
  <a class="nav-link text-dark" href="#" data-view="archive.html">
    <i class="material-symbols-rounded opacity-5">history</i>
    <span class="nav-link-text ms-1">Archivo</span>
  </a>
</li>

<!-- Sesión -->
<li class="nav-item mt-3" id="liTituloSesion">
  <h6 class="ps-4 ms-2 text-uppercase text-xs text-dark font-weight-bolder opacity-5">SESIÓN</h6>
</li>

<li class="nav-item" id="liCerrarSesion">
  <a class="nav-link text-dark" href="login.html" id="cerrarSesion">
    <i class="material-symbols-rounded opacity-5">logout</i>
    <span class="nav-link-text ms-1">Cerrar sesión</span>
  </a>
</li>

    </ul>
  </div>
</aside>


  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">
  <!-- Navbar -->
  <nav class="navbar navbar-main navbar-expand-lg px-0 mx-3 shadow-none border-radius-xl" id="navbarBlur" data-scroll="true">
    <div class="container-fluid py-1 px-3">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
          <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Principal</a></li>
          <li class="breadcrumb-item text-sm text-dark active" aria-current="page" id="breadcrumb-title">Panel de control</li>
        </ol>
      </nav>
      <ul class="navbar-nav d-flex align-items-center justify-content-end">
        <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
          <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
            <div class="sidenav-toggler-inner">
              <i class="sidenav-toggler-line"></i>
              <i class="sidenav-toggler-line"></i>
              <i class="sidenav-toggler-line"></i>
            </div>
          </a>
        </li>
        <li class="nav-item px-3 d-flex align-items-center">
          <a href="javascript:;" class="nav-link text-body p-0">
            <i class="material-symbols-rounded fixed-plugin-button-nav">settings</i>
          </a>
        </li>
        <li class="nav-item dropdown pe-3 d-flex align-items-center">
          <a href="javascript:;" class="nav-link text-body p-0 position-relative" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="material-symbols-rounded">notifications</i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end px-2 py-3 me-sm-n4" aria-labelledby="dropdownMenuButton">
            <!-- Las notificaciones se cargarán dinámicamente aquí -->
          </ul>
        </li>
        <li class="nav-item d-flex align-items-center">
          <a href="javascript:;" class="nav-link text-body font-weight-bold px-0">
            <i class="material-symbols-rounded">account_circle</i>
          </a>
        </li>
      </ul>
    </div>
  </nav>
  <!-- End Navbar -->
</main>

<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg px-3 py-4" id="main-content" style="min-height: calc(100vh - 100px); overflow: auto;">
  <h3></h3>
</main>

<!-- Configurador flotante -->
<div class="fixed-plugin">
  <a class="fixed-plugin-button text-dark position-fixed px-3 py-2">
    <i class="material-symbols-rounded py-2">settings</i>
  </a>
  <div class="card shadow-lg">
    <div class="card-header pb-0 pt-3">
      <div class="float-start">
        <h5 class="mt-3 mb-0">Configurador de Interfaz</h5>
        <p>Explora las opciones del panel.</p>
      </div>
      <div class="float-end mt-4">
        <button class="btn btn-link text-dark p-0 fixed-plugin-close-button">
          <i class="material-symbols-rounded">clear</i>
        </button>
      </div>
    </div>

    <hr class="horizontal dark my-1">

    <div class="card-body pt-sm-3 pt-0">
      <!-- Colores del sidebar -->
      <div>
        <h6 class="mb-0">Colores del menú lateral</h6>
      </div>
      <a href="javascript:void(0)" class="switch-trigger background-color">
        <div class="badge-colors my-2 text-start">
          <span class="badge filter bg-gradient-primary" data-color="primary" onclick="sidebarColor(this)"></span>
          <span class="badge filter bg-gradient-dark active" data-color="dark" onclick="sidebarColor(this)"></span>
          <span class="badge filter bg-gradient-info" data-color="info" onclick="sidebarColor(this)"></span>
          <span class="badge filter bg-gradient-success" data-color="success" onclick="sidebarColor(this)"></span>
          <span class="badge filter bg-gradient-warning" data-color="warning" onclick="sidebarColor(this)"></span>
          <span class="badge filter bg-gradient-danger" data-color="danger" onclick="sidebarColor(this)"></span>
        </div>
      </a>

      <!-- Tipo de menú lateral -->
      <div class="mt-3">
        <h6 class="mb-0">Tipo de menú lateral</h6>
        <p class="text-sm">Elige entre los diferentes estilos disponibles.</p>
      </div>
      <div class="d-flex">
        <button class="btn bg-gradient-dark px-3 mb-2" data-class="bg-gradient-dark" onclick="sidebarType(this)">Oscuro</button>
        <button class="btn bg-gradient-dark px-3 mb-2 ms-2" data-class="bg-transparent" onclick="sidebarType(this)">Transparente</button>
        <button class="btn bg-gradient-dark px-3 mb-2 active ms-2" data-class="bg-white" onclick="sidebarType(this)">Blanco</button>
      </div>
      <p class="text-sm d-xl-none d-block mt-2">Puedes cambiar el tipo de menú lateral solo en pantallas grandes.</p>

      <!-- Fijar navbar -->
      <div class="mt-3 d-flex">
        <h6 class="mb-0">Fijar barra superior</h6>
        <div class="form-check form-switch ps-0 ms-auto my-auto">
          <input class="form-check-input mt-1 ms-auto" type="checkbox" id="navbarFixed" onclick="navbarFixed(this)">
        </div>
      </div>

      <hr class="horizontal dark my-3">

      <!-- Modo claro/oscuro -->
      <div class="mt-2 d-flex">
        <h6 class="mb-0">Modo Claro / Oscuro</h6>
        <div class="form-check form-switch ps-0 ms-auto my-auto">
          <input class="form-check-input mt-1 ms-auto" type="checkbox" id="dark-version" onclick="darkMode(this)">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Core JS -->
 
 <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.72/vfs_fonts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="../assets/js/core/popper.min.js"></script>
<script src="../assets/js/core/bootstrap.min.js"></script>
<script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
<script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
<script src="../assets/js/plugins/chartjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script src="../js/auth.js"></script>
<script src="../js/notifications.js"></script>
<script>
  var win = navigator.platform.indexOf('Win') > -1;
  if (win && document.querySelector('#sidenav-scrollbar')) {
    var options = { damping: '0.5' };
    Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
  }
</script>

<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="../assets/js/material-dashboard.min.js?v=3.2.0"></script>

<!-- Cierre de sesión con SweetAlert -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const cerrarSesion = document.getElementById('cerrarSesion');
    if (cerrarSesion) {
      cerrarSesion.addEventListener('click', (e) => {
        e.preventDefault();
        document.body.style.overflow = 'hidden';

        Swal.fire({
          title: '¿Estás seguro?',
          text: 'Cerrarás tu sesión actual.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Sí',
          cancelButtonText: 'Cancelar',
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          backdrop: true,
          allowOutsideClick: false,
          allowEscapeKey: true
        }).then((result) => {
          document.body.style.overflow = 'auto';
          if (result.isConfirmed) {
            window.location.href = 'login.html';
          }
        });
      });
    }
  });
</script>

<script src="../js/rol.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const links = document.querySelectorAll("[data-view]");
    const mainContent = document.getElementById("main-content");
    const breadcrumbTitle = document.getElementById("breadcrumb-title");

    // 🔄 Actualiza la clase activa del menú lateral
    window.updateActiveSidebar = (viewUrl) => {
      const navItems = document.querySelectorAll('.nav-link[data-view]');
      navItems.forEach(link => {
        link.classList.remove("active", "bg-gradient-dark", "text-white");
        link.classList.add("text-dark");
        if (link.getAttribute("data-view") === viewUrl) {
          link.classList.remove("text-dark");
          link.classList.add("active", "bg-gradient-dark", "text-white");
        }
      });
    };

    // 📥 Carga una vista HTML y su JS asociado
    window.loadView = async (url) => {
      try {
        // Asegura que la extensión sea .html
        let cleanUrl = url.split("?")[0];
        if (!cleanUrl.endsWith('.html')) cleanUrl += '.html';

        // Siempre busca en la carpeta views/
        let finalUrl = cleanUrl;

        // Realiza el fetch de la vista
        const res = await fetch(finalUrl);
        const html = await res.text();
        mainContent.innerHTML = html;  // Inserta el contenido HTML en el contenedor principal
        window.updateActiveSidebar(url);     // Actualiza la clase activa en el sidebar

        // 🧭 Actualiza el título del breadcrumb
        if (breadcrumbTitle) {
          const traducciones = {
            'dashboard': 'Panel',
            'user': 'Usuarios',
            'patient': 'Pacientes',
            'doctor': 'Doctores',
            'exam': 'Exámenes',
            'quoter': 'Cotizador',
            'order': 'Órdenes',
            'report': 'Análisis',
            'validated': 'Validación',
            'remission': 'Remisión',
            'archive': 'Archivo',
            'parameter': 'Parámetros',
            'index': 'Panel de control',
            'neworder': 'Nueva orden',
            // Agrega más si tienes otros módulos
          };
          const modulo = cleanUrl.split("/").pop().replace(".html", "");
          breadcrumbTitle.textContent = traducciones[modulo] || modulo.charAt(0).toUpperCase() + modulo.slice(1);
        }

        // 🔁 Elimina el script anterior si existe
        const prevScript = document.getElementById("script-vista");
        if (prevScript) prevScript.remove();

        // 🧠 Genera nombre de función init basado en nombre del archivo
        const scriptBase = cleanUrl.split("/").pop().replace(".html", "");
        const initName = "init" + scriptBase
          .split("-")
          .map(part => part.charAt(0).toUpperCase() + part.slice(1))
          .join("");

        // ⬇️ Crea el nuevo script y lo carga
        const script = document.createElement("script");
        script.id = "script-vista";
        script.src = `../js/${scriptBase === 'parametros' ? 'parameter' : scriptBase}.js`;
        script.type = "text/javascript";
        script.onload = () => {
          if (typeof window[initName] === "function") {
            window[initName]();
          }
        };
        script.onerror = () => {
          console.error(`❌ Error al cargar el script ${script.src}`);
        };
        document.body.appendChild(script);

        // 🔗 Actualiza la URL con el hash de la vista cargada (esto permite la navegación)
        window.history.pushState(null, "", `#${cleanUrl}`);
      } catch (error) {
        console.error("❌ Error al cargar la vista:", error);
        mainContent.innerHTML = "<p>Error al cargar la vista.</p>";
      }
    };

    // 🚦 Maneja clics en el menú lateral
    links.forEach(link => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const viewUrl = link.getAttribute("data-view");
        if (viewUrl) window.loadView(viewUrl);
      });
    });

    // 🔁 Soporte para botones de navegación del navegador (adelante / atrás)
    window.addEventListener("popstate", () => {
      const hash = window.location.hash.substring(1);
      if (hash) {
        window.loadView(hash);
        window.updateActiveSidebar(hash);
      }
    });

    // Si es la primera carga, carga el dashboard
    window.loadView('dashboard.html');
  });
</script>



</body>

</html>
